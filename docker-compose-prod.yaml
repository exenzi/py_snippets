version: "3.9"
services:
    db:
        image: postgres:alpine
        container_name: django-db
        env_file:
            ./.env
        volumes:
            - ./data/postgres/data:/var/lib/postgresql/data

    web:
        container_name: django-web
        build: ./src
        env_file:
            ./.env
        volumes:
            - /var/www/static:/app/static
            - /var/www/media:/app/media
        command: pipenv run start
        ports:
            - '8000:8000'
        depends_on:
            - db
    
    # certbot:
    #     image: certbot/certbot
    #     restart: unless-stopped
    #     volumes:
    #         - ./data/certbot/conf:/etc/letsencrypt
    #         - ./data/certbot/www:/var/www/certbot
    #     entrypoint: "/bin/sh -c 'trap exit TERM; while :; do certbot renew; sleep 5d & wait $${!}; done;'"

    # nginx:
    #     image: nginx:alpine
    #     restart: unless-stopped
    #     volumes:
    #         - ./data/nginx/conf.d:/etc/nginx/conf.d
    #         - ./data/certbot/conf:/etc/letsencrypt
    #         - ./data/certbot/www:/var/www/certbot 
    #         - ./src/static:/static
    #         - ./src/media:/media
    #     command: "/bin/sh -c 'while :; do sleep 6h & wait $${!}; nginx -s reload; done & nginx -g \"daemon off;\"'"
    #     ports:
    #         - "80:80"
    #         - "443:443"
    #     depends_on:
    #     - web


volumes:
    pgdata:
    venvs: